{
  "_type": "workflow",
  "description": "Dataflow for the Sales Analytics Application.",
  "name": "SalesAnalyticsDataflow",
  "workflowDefinition": {
    "Extract_Account": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "Name"
          },
          {
            "name": "OwnerId"
          },
          {
            "name": "${Variables.Source.fieldName}"
          },
          {
            "name": "${Variables.Customer.fieldName}"
          },
          {
            "name": "${Variables.Customer_L2.fieldName}"
          },
          {
            "name": "${Variables.Geography.fieldName}"
          },
          {
            "name": "${Variables.Geography_L2.fieldName}"
          },
          {
            "name": "CreatedDate"
          },
          {
            "name": "LastModifiedDate"
          }
        ],
        "object": "Account"
      }
    },
    "Extract_Event": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {
            "name": "OwnerId"
          },
          {
            "name": "CreatedDate"
          },
          {
            "name": "LastModifiedDate"
          },
          {
            "name": "ActivityDate"
          },
          {
            "name": "Subject"
          },
          {
            "name": "DurationInMinutes"
          },
          {
            "name": "EventSubtype"
          },
          {
            "name": "WhatId"
          }
        ],
        "complexFilterConditions": "CreatedDate >= LAST_N_DAYS:730",
        "object": "Event"
      }
    },
    "Extract_Opportunity": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "AccountId"
          },
          {
            "name": "OwnerId"
          },
          {
            "name": "Name"
          },
          {
            "name": "StageName"
          },
          {
            "name": "${Variables.Source_L2.fieldName}"
          },
          {
            "name": "IsWon"
          },
          {
            "name": "${Variables.Bookings.fieldName}"
          },
          {
            "name": "IsClosed"
          },
          {
            "name": "ForecastCategory"
          },
          {
            "name": "ForecastCategoryName"
          },
          {
            "name": "CreatedDate"
          },
          {
            "name": "CloseDate"
          },
          {
            "name": "${Variables.Opportunity_Amount.fieldName}"
          },
          {
            "name": "CreatedById"
          }
        ],
        "object": "Opportunity"
      }
    },
    "Extract_OpportunityAmount": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "Amount"
          }
        ],
        "object": "Opportunity"
      }
    },
    "Extract_OpportunityHistory": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {
            "name": "Amount"
          },
          {
            "name": "CloseDate"
          },
          {
            "name": "CreatedById"
          },
          {
            "name": "CreatedDate"
          },
          {
            "name": "ForecastCategory"
          },
          {
            "name": "Id"
          },
          {
            "name": "IsDeleted"
          },
          {
            "name": "OpportunityId"
          },
          {
            "name": "StageName"
          }
        ],
        "object": "OpportunityHistory"
      },
      "schema": {
        "objects": [
          {
            "fields": [
              {
                "description": "Opportunity Created Date",
                "format": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
                "label": "CreatedDate",
                "name": "CreatedDate"
              },
              {
                "description": "Amount",
                "label": "Amount",
                "name": "Amount"
              }
            ],
            "label": "OpportunityHistory"
          }
        ]
      }
    },
    "Extract_OpportunityLineItem": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "OpportunityId"
          },
          {
            "name": "ProductCode"
          },
          {
            "name": "ListPrice"
          },
          {
            "name": "Quantity"
          },
          {
            "name": "${Variables.Product_Amount.fieldName}"
          },
          {
            "name": "PricebookEntryId"
          }
        ],
        "object": "OpportunityLineItem"
      }
    },
    "Extract_OpportunityStage": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {
            "name": "IsClosed"
          },
          {
            "name": "CreatedDate"
          },
          {
            "name": "Description"
          },
          {
            "name": "ForecastCategory"
          },
          {
            "name": "ForecastCategoryName"
          },
          {
            "name": "IsActive"
          },
          {
            "name": "LastModifiedDate"
          },
          {
            "name": "MasterLabel"
          },
          {
            "name": "Id"
          },
          {
            "name": "DefaultProbability"
          },
          {
            "name": "SortOrder"
          },
          {
            "name": "SystemModstamp"
          },
          {
            "name": "IsWon"
          }
        ],
        "object": "OpportunityStage"
      }
    },
    "Extract_PricebookEntry": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "Product2Id"
          }
        ],
        "object": "PricebookEntry"
      }
    },
    "Extract_Product": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "ProductCode"
          },
          {
            "name": "${Variables.Product_L2.fieldName}"
          },
          {
            "name": "${Variables.Product.fieldName}"
          }
        ],
        "object": "Product2"
      }
    },
    "Extract_Quota": {
      "action": "edgemart",
      "parameters": {
        "alias": "${App.EdgeMarts.plain_quota.Alias}"
      }
    },
    "Extract_Task": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "CallDurationInSeconds"
          },
          {
            "name": "CallDisposition"
          },
          {
            "name": "CallType"
          },
          {
            "name": "OwnerId"
          },
          {
            "name": "Status"
          },
          {
            "name": "Priority"
          },
          {
            "name": "IsClosed"
          },
          {
            "name": "TaskSubtype"
          },
          {
            "name": "CreatedDate"
          },
          {
            "name": "ActivityDate"
          },
          {
            "name": "LastModifiedDate"
          },
          {
            "name": "Subject"
          },
          {
            "name": "WhatId"
          }
        ],
        "complexFilterConditions": "CreatedDate >= LAST_N_DAYS:730",
        "object": "Task"
      }
    },
    "Extract_User": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "Username"
          },
          {
            "name": "Name"
          },
          {
            "name": "FirstName"
          },
          {
            "name": "LastName"
          },
          {
            "name": "UserRoleId"
          },
          {
            "name": "IsActive"
          }
        ],
        "object": "User"
      }
    },
    "Extract_UserRole": {
      "action": "sfdcDigest",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "fields": [
          {
            "name": "Id"
          },
          {
            "name": "Name"
          },
          {
            "name": "DeveloperName"
          },
          {
            "name": "ParentRoleId"
          },
          {
            "name": "LastModifiedDate"
          },
          {
            "name": "LastModifiedById"
          },
          {
            "name": "SystemModstamp"
          }
        ],
        "object": "UserRole"
      }
    },
    "Discount_Field": {
      "action": "computeExpression",
      "parameters": {
        "source": "Extract_OpportunityLineItem",
        "mergeWithSource": true,
        "computedFields": [
          {
            "precision": 7,
            "name": "Discount_Percent",
            "saqlExpression": "1-(('${Variables.Product_Amount.fieldName}')/('ListPrice' * 'Quantity'))",
            "scale": 6,
            "type": "Numeric"
          }
        ]
      }
    },
    "Flag_For_Days_in_Current_Stage": {
      "action": "computeExpression",
      "parameters": {
        "source": "Extract_OpportunityHistory",
        "mergeWithSource": true,
        "computedFields": [
          {
            "defaultValue": "\"1\"",
            "name": "Stage_isUpdated",
            "saqlExpression": "case when 'StageName' == 'StageNamePrev' then \"0\" else \"1\" end",
            "type": "Text"
          },
          {
            "defaultValue": "\"1\"",
            "name": "CloseDate_isUpdated",
            "saqlExpression": "case when 'CloseDatePrev' == 'CloseDate' then \"0\" else \"1\" end",
            "type": "Text"
          }
        ]
      }
    },
    "Filter_User": {
      "action": "filter",
      "parameters": {
        "filter": "IsActive:EQ:true",
        "source": "Extract_User"
      }
    },
    "Flatten_UserRole": {
      "action": "flatten",
      "parameters": {
        "multi_field": "Roles",
        "parent_field": "ParentRoleId",
        "path_field": "RolePath",
        "self_field": "Id",
        "source": "Extract_UserRole"
      },
      "schema": {
        "objects": [
          {
            "fields": [
              {
                "isSystemField": false,
                "label": "Roles",
                "name": "Roles"
              },
              {
                "isSystemField": false,
                "label": "RolePath",
                "name": "RolePath"
              }
            ],
            "label": "Flatten_UserRole"
          }
        ]
      }
    },
    "Flatten_UserRoleNames": {
      "action": "flatten",
      "parameters": {
        "multi_field": "RoleNames",
        "parent_field": "ParentRole.DeveloperName",
        "path_field": "RoleNamesPath",
        "self_field": "Role.DeveloperName",
        "source": "User_with_Roles_ParentName"
      },
      "schema": {
        "objects": [
          {
            "fields": [
              {
                "isSystemField": false,
                "label": "RoleNames",
                "name": "RoleNames"
              },
              {
                "isSystemField": false,
                "label": "RoleNamesPath",
                "name": "RoleNamesPath"
              }
            ],
            "label": "Flatten_UserRoleNames"
          }
        ]
      }
    },
    "Join_AccountOwner": {
      "action": "augment",
      "parameters": {
        "left": "Extract_Account",
        "left_key": [
          "OwnerId"
        ],
        "relationship": "Owner",
        "right": "Flatten_UserRoleNames",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "Username",
          "UserRoleId",
          "Role.Name",
          "Role.DeveloperName",
          "Role.Roles",
          "Role.RolePath",
          "Role.ParentRoleId",
          "ParentRole.Name",
          "ParentRole.DeveloperName",
          "RoleNames",
          "RoleNamesPath"
        ]
      }
    },
    "Join_EventOwner": {
      "action": "augment",
      "parameters": {
        "left": "Extract_Event",
        "left_key": [
          "OwnerId"
        ],
        "relationship": "Owner",
        "right": "Flatten_UserRoleNames",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "Username",
          "UserRoleId",
          "Role.Name",
          "Role.DeveloperName",
          "Role.Roles",
          "Role.RolePath",
          "Role.ParentRoleId",
          "ParentRole.Name",
          "ParentRole.DeveloperName",
          "RoleNames",
          "RoleNamesPath"
        ]
      }
    },
    "Join_EventOwner_Product": {
      "action": "augment",
      "parameters": {
        "left": "Join_EventOwner",
        "left_key": [
          "WhatId"
        ],
        "operation": "LookupMultiValue",
        "relationship": "Opportunity",
        "right": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
        "right_key": [
          "OpportunityId"
        ],
        "right_select": [
          "Product.${Variables.Product.fieldName}",
          "Product.${Variables.Product_L2.fieldName}"
        ]
      }
    },
    "Join_EventOwner_Product_Opp": {
      "action": "augment",
      "parameters": {
        "left": "Join_EventOwner_Product",
        "left_key": [
          "WhatId"
        ],
        "relationship": "Opportunity",
        "right": "Join_OpportunityOwner",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Id",
          "Name",
          "Type",
          "OwnerId",
          "IsWon",
          "IsClosed",
          "AccountId",
          "CloseDate",
          "StageName",
          "CreatedDate",
          "${Variables.Source_L2.fieldName}",
          "ForecastCategoryName",
          "Account.Name",
          "Account.${Variables.Customer.fieldName}",
          "Account.${Variables.Customer_L2.fieldName}",
          "Account.${Variables.Source.fieldName}",
          "Account.${Variables.Geography.fieldName}",
          "Account.${Variables.Geography_L2.fieldName}"
        ]
      }
    },
    "Join_EventOwner_Product_Opp_User": {
      "action": "augment",
      "parameters": {
        "left": "Join_EventOwner_Product_Opp",
        "left_key": [
          "OwnerId"
        ],
        "relationship": "AssignedTo",
        "right": "Extract_User",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name"
        ]
      }
    },
    "Join_OpportunityAccount": {
      "action": "augment",
      "parameters": {
        "left": "Extract_Opportunity",
        "left_key": [
          "AccountId"
        ],
        "relationship": "Account",
        "right": "Join_AccountOwner",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "${Variables.Customer.fieldName}",
          "${Variables.Customer_L2.fieldName}",
          "${Variables.Geography.fieldName}",
          "${Variables.Geography_L2.fieldName}",
          "${Variables.Source.fieldName}",
          "OwnerId",
          "Owner.Name",
          "Owner.Role.Name",
          "Owner.Role.Roles",
          "Owner.Role.RolePath",
          "Owner.Role.ParentRoleId"
        ]
      }
    },
    "Join_OpportunityLineItemPricebookEntry": {
      "action": "augment",
      "parameters": {
        "left": "Discount_Field",
        "left_key": [
          "PricebookEntryId"
        ],
        "relationship": "Pricebook",
        "right": "Extract_PricebookEntry",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Product2Id"
        ]
      }
    },
    "Join_OpportunityLineItemPricebookEntryProduct": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityLineItemPricebookEntry",
        "left_key": [
          "Pricebook.Product2Id"
        ],
        "relationship": "Product",
        "right": "Extract_Product",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "ProductCode",
          "${Variables.Product_L2.fieldName}",
          "${Variables.Product.fieldName}"
        ]
      }
    },
    "Join_OpportunityOpportunityLineItemPricebookEntryProduct": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityLineItemPricebookEntryProduct",
        "left_key": [
          "OpportunityId"
        ],
        "relationship": "Opportunity",
        "right": "Join_OpportunityOwner",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "StageName",
          "CloseDate",
          "IsWon",
          "${Variables.Bookings.fieldName}",
          "IsClosed",
          "${Variables.Source_L2.fieldName}",
          "ForecastCategory",
          "ForecastCategoryName",
          "CreatedDate",
          "AccountId",
          "Account.Name",
          "Account.OwnerId",
          "Account.${Variables.Customer.fieldName}",
          "Account.${Variables.Customer_L2.fieldName}",
          "Account.${Variables.Geography.fieldName}",
          "Account.${Variables.Geography_L2.fieldName}",
          "Account.${Variables.Source.fieldName}",
          "Account.Owner.Name",
          "Account.Owner.Role.Name",
          "Account.Owner.Role.Roles",
          "Account.Owner.Role.RolePath",
          "OwnerId",
          "Owner.Name",
          "Owner.Role.Name",
          "Owner.Role.DeveloperName",
          "Owner.Role.Roles",
          "Owner.Role.RolePath",
          "Owner.Role.ParentRoleId"
        ]
      }
    },
    "Join_OpportunityOwner": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityAccount",
        "left_key": [
          "OwnerId"
        ],
        "relationship": "Owner",
        "right": "Flatten_UserRoleNames",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "Username",
          "UserRoleId",
          "Role.Name",
          "Role.DeveloperName",
          "Role.Roles",
          "Role.RolePath",
          "Role.ParentRoleId",
          "ParentRole.Name",
          "ParentRole.DeveloperName",
          "RoleNames",
          "RoleNamesPath"
        ]
      }
    },
    "Join_OpportunityOwner_Product": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityOwner",
        "left_key": [
          "Id"
        ],
        "operation": "LookupMultiValue",
        "relationship": "Product",
        "right": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
        "right_key": [
          "OpportunityId"
        ],
        "right_select": [
          "Product.${Variables.Product.fieldName}",
          "Product.${Variables.Product_L2.fieldName}"
        ]
      }
    },
    "Join_OpportunityStage": {
      "action": "augment",
      "parameters": {
        "left": "Flag_For_Days_in_Current_Stage",
        "left_key": [
          "StageName"
        ],
        "relationship": "Stage",
        "right": "Extract_OpportunityStage",
        "right_key": [
          "MasterLabel"
        ],
        "right_select": [
          "IsClosed",
          "IsWon"
        ]
      }
    },
    "Join_OpportunityStage_Previous": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityStage",
        "left_key": [
          "StageNamePrev"
        ],
        "relationship": "StagePrev",
        "right": "Extract_OpportunityStage",
        "right_key": [
          "MasterLabel"
        ],
        "right_select": [
          "IsClosed",
          "IsWon"
        ]
      }
    },
    "Join_OpportunityStage_Previous_with_Opp": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityStage_Previous",
        "left_key": [
          "OpportunityId"
        ],
        "relationship": "Opportunity",
        "right": "Join_OpportunityOwner",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "Type",
          "IsWon",
          "IsClosed",
          "OwnerId",
          "AccountId",
          "CloseDate",
          "StageName",
          "${Variables.Source_L2.fieldName}",
          "ForecastCategoryName",
          "Account.Name",
          "Account.${Variables.Customer.fieldName}",
          "Account.${Variables.Customer_L2.fieldName}",
          "Account.${Variables.Source.fieldName}",
          "Account.${Variables.Geography_L2.fieldName}",
          "Account.${Variables.Geography.fieldName}",
          "Owner.Name",
          "Owner.RoleNames",
          "Owner.Role.Name",
          "Owner.Role.DeveloperName",
          "Owner.Role.Roles",
          "Owner.Role.RolePath"
        ]
      }
    },
    "Join_OpportunityStage_Previous_with_Opp_Amount": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityStage_Previous_with_Opp",
        "left_key": [
          "OpportunityId"
        ],
        "relationship": "Opportunity",
        "right": "Extract_OpportunityAmount",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Amount"
        ]
      }
    },
    "Join_OpportunityStage_Previous_with_Opp_Amount_Product": {
      "action": "augment",
      "parameters": {
        "left": "Join_OpportunityStage_Previous_with_Opp_Amount",
        "left_key": [
          "OpportunityId"
        ],
        "operation": "LookupMultiValue",
        "relationship": "Opportunity",
        "right": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
        "right_key": [
          "OpportunityId"
        ],
        "right_select": [
          "Product.${Variables.Product.fieldName}",
          "Product.${Variables.Product_L2.fieldName}"
        ]
      }
    },
    "Join_Quota_User": {
      "action": "augment",
      "parameters": {
        "left": "Extract_Quota",
        "left_key": [
          "Username"
        ],
        "relationship": "User",
        "right": "Flatten_UserRoleNames",
        "right_key": [
          "Username"
        ],
        "right_select": [
          "Id",
          "Name",
          "Username",
          "UserRoleId",
          "Role.Name",
          "Role.DeveloperName",
          "Role.Roles",
          "Role.RolePath",
          "Role.ParentRoleId",
          "ParentRole.Name",
          "ParentRole.DeveloperName",
          "RoleNames",
          "RoleNamesPath"
        ]
      }
    },
    "Join_TaskOwner": {
      "action": "augment",
      "parameters": {
        "left": "Extract_Task",
        "left_key": [
          "OwnerId"
        ],
        "relationship": "Owner",
        "right": "Flatten_UserRoleNames",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "Username",
          "UserRoleId",
          "Role.Name",
          "Role.DeveloperName",
          "Role.Roles",
          "Role.RolePath",
          "Role.ParentRoleId",
          "ParentRole.Name",
          "ParentRole.DeveloperName",
          "RoleNames",
          "RoleNamesPath"
        ]
      }
    },
    "Join_TaskOwner_Product": {
      "action": "augment",
      "parameters": {
        "left": "Join_TaskOwner",
        "left_key": [
          "WhatId"
        ],
        "operation": "LookupMultiValue",
        "relationship": "Opportunity",
        "right": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
        "right_key": [
          "OpportunityId"
        ],
        "right_select": [
          "Product.${Variables.Product.fieldName}",
          "Product.${Variables.Product_L2.fieldName}"
        ]
      }
    },
    "Join_TaskOwner_Product_Opp": {
      "action": "augment",
      "parameters": {
        "left": "Join_TaskOwner_Product",
        "left_key": [
          "WhatId"
        ],
        "relationship": "Opportunity",
        "right": "Join_OpportunityOwner",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Id",
          "Name",
          "Type",
          "OwnerId",
          "IsWon",
          "IsClosed",
          "AccountId",
          "CloseDate",
          "StageName",
          "CreatedDate",
          "${Variables.Source_L2.fieldName}",
          "ForecastCategoryName",
          "Account.Name",
          "Account.${Variables.Customer.fieldName}",
          "Account.${Variables.Customer_L2.fieldName}",
          "Account.${Variables.Source.fieldName}",
          "Account.${Variables.Geography.fieldName}",
          "Account.${Variables.Geography_L2.fieldName}"
        ]
      }
    },
    "Join_TaskOwner_Product_Opp_User": {
      "action": "augment",
      "parameters": {
        "left": "Join_TaskOwner_Product_Opp",
        "left_key": [
          "OwnerId"
        ],
        "relationship": "AssignedTo",
        "right": "Filter_User",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name"
        ]
      }
    },
    "Register_Event": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.event.Alias}",
        "name": "Event",
        "rowLevelSecurityFilter": "'Owner.Role.Roles' == \"$User.UserRoleId\" || 'OwnerId' == \"$User.Id\"",
        "source": "Join_EventOwner_Product_Opp_User"
      }
    },
    "Register_Opportunity": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.opportunity.Alias}",
        "name": "Opportunities",
        "rowLevelSecurityFilter": "'Owner.Role.Roles' == \"$User.UserRoleId\" || 'OwnerId' == \"$User.Id\"",
        "source": "Join_OpportunityOwner_Product"
      }
    },
    "Register_OpportunityProducts": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.opportunity_products.Alias}",
        "name": "Oppty Products",
        "rowLevelSecurityFilter": "'Opportunity.Owner.Role.Roles' == \"$User.UserRoleId\" || 'Opportunity.OwnerId' == \"$User.Id\"",
        "source": "Join_OpportunityOpportunityLineItemPricebookEntryProduct"
      }
    },
    "Register_Pipeline_Trending": {
      "action": "sfdcRegister",
      "parameters": {
        "alias": "${App.EdgeMarts.pipeline_trending.Alias}",
        "name": "Pipeline Trending",
        "rowLevelSecurityFilter": "'Opportunity.Owner.Role.Roles' == \"$User.UserRoleId\" || 'Opportunity.OwnerId' == \"$User.Id\"",
        "source": "Join_OpportunityStage_Previous_with_Opp_Amount_Product"
      }
    },
    "Register_PlainQuota": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.plain_quota.Alias}",
        "name": "Quota",
        "source": "Extract_Quota"
      }
    },
    "Register_QuotaWithRoles": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.quota.Alias}",
        "name": "Quota User Manager",
        "source": "Join_Quota_User"
      }
    },
    "Register_Task": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.task.Alias}",
        "name": "Task",
        "rowLevelSecurityFilter": "'Owner.Role.Roles' == \"$User.UserRoleId\" || 'OwnerId' == \"$User.Id\"",
        "source": "Join_TaskOwner_Product_Opp_User"
      }
    },
    "Register_UserManager": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.user.Alias}",
        "name": "User Manager",
        "rowLevelSecurityFilter": "'Role.Roles' == \"$User.UserRoleId\" || 'Id' == \"$User.Id\"",
        "source": "Flatten_UserRoleNames"
      }
    },
    "Register_UserRole": {
      "action": "sfdcRegister",
      "parameters": {
        "SFDCtoken": "SFDCtoken",
        "alias": "${App.EdgeMarts.user_role.Alias}",
        "name": "User Role",
        "rowLevelSecurityFilter": "'Id' == \"$User.Id\"",
        "source": "Flatten_UserRoleNames"
      }
    },
    "User_with_Roles": {
      "_comment": "Get user's role hierarchy",
      "action": "augment",
      "parameters": {
        "left": "Filter_User",
        "left_key": [
          "UserRoleId"
        ],
        "relationship": "Role",
        "right": "Flatten_UserRole",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "DeveloperName",
          "Roles",
          "RolePath",
          "ParentRoleId"
        ]
      }
    },
    "User_with_Roles_ParentName": {
      "_comment": "get parent role's rolename",
      "action": "augment",
      "parameters": {
        "left": "User_with_Roles",
        "left_key": [
          "Role.ParentRoleId"
        ],
        "relationship": "ParentRole",
        "right": "Extract_UserRole",
        "right_key": [
          "Id"
        ],
        "right_select": [
          "Name",
          "DeveloperName"
        ]
      }
    },
    "computeTrending": {
      "action": "computeRelative",
      "parameters": {
        "computedFields": [
          {
            "description": "Opportunity Created Date",
            "expression": {
              "default": "current()",
              "offset": "first()",
              "sourceField": "CreatedDate"
            },
            "label": "OpportunityCreatedDate",
            "name": "OpportunityCreatedDate"
          },
          {
            "description": "ValidToDate",
            "expression": {
              "default": "3000-01-01T00:00:00.000Z",
              "offset": "next()",
              "sourceField": "CreatedDate"
            },
            "label": "ValidToDate",
            "name": "ValidToDate"
          },
          {
            "description": "ValidFromDate",
            "expression": {
              "default": "current()",
              "offset": "current()",
              "sourceField": "CreatedDate"
            },
            "label": "ValidFromDate",
            "name": "ValidFromDate"
          },
          {
            "description": "AmountPrev",
            "expression": {
              "default": "0",
              "offset": "previous()",
              "sourceField": "Amount"
            },
            "label": "AmountPrev",
            "name": "AmountPrev"
          },
          {
            "description": "Previous Stage Name",
            "expression": {
              "default": null,
              "offset": "previous()",
              "sourceField": "StageName"
            },
            "label": "Prev Stage Name",
            "name": "StageNamePrev"
          },
          {
            "description": "ForecastCategoryPrev",
            "expression": {
              "default": null,
              "offset": "previous()",
              "sourceField": "ForecastCategory"
            },
            "label": "ForecastCategoryPrev",
            "name": "ForecastCategoryPrev"
          },
          {
            "description": "Previous Close Date",
            "expression": {
              "default": "1970-01-01",
              "offset": "previous()",
              "sourceField": "CloseDate"
            },
            "label": "Prev Close Date",
            "name": "CloseDatePrev"
          },
          {
            "description": "Previous Created Date",
            "expression": {
              "default": null,
              "offset": "previous()",
              "sourceField": "CreatedDate"
            },
            "label": "Prev CreatedDate",
            "name": "CreatedDatePrev"
          }
        ],
        "orderBy": [
          {
            "direction": "asc",
            "name": "CreatedDate"
          }
        ],
        "partitionBy": [
          "OpportunityId"
        ],
        "source": "Extract_OpportunityHistory"
      }
    }
  }
}
