{
	"constants": [
	    {
	      "name": "FSL_compute_expression_ResourceAbsence_End_minus_Start_params_source",
	      "value": "${Variables.isDemoApplication == 'Yes' ? 'FSL_digest_ResourceAbsence_cleaned' : 'FSL_digest_ResourceAbsence'}"
	    }
	],
	"rules": [
		{
      		"name": "HandleResourceAbsenceExtraction",
      		"condition": "${Variables.isDemoApplication == 'Yes'}",
      		"actions": [
      			{
      				"action": "add",
      				"description": "Add CreatedDate__c field in ResourceAbsence extraction.",
      				"path": "$.workflowDefinition.FSL_digest_ResourceAbsence.parameters.fields",
      				"index": 4,
      				"value": {
      					"name": "CreatedDate__c"
      				}
      			},
      			{
      				"action": "add",
      				"description": "Add Put External ID field in ResourceAbsence extraction.",
      				"path": "$.workflowDefinition.FSL_digest_ResourceAbsence.parameters.fields",
      				"index": 5,
      				"value": {
      					"name": "External_ID__c"
      				}
      			},
      			{
      				"action": "put",
      				"description": "Filter to get the user's generated data.",
      				"key": "FSL_digest_ResourceAbsence_get_Users_Data",
      				"path": "$.workflowDefinition",
      				"value": {
      					"action": "filter",      
						"parameters": {            
							"filter": "External_ID__c:EQ:''",
							"source": "FSL_digest_ResourceAbsence"
						}
      				}
      			},
      			{
      				"action": "put",
      				"description": "Filter to get the data generated for demo.",
      				"path": "$.workflowDefinition",
      				"key": "FSL_digest_ResourceAbsence_get_Demo_Data",
      				"value": {
      					"action": "filter",      
						"parameters": {            
							"filter": "External_ID__c:N:''",
							"source": "FSL_digest_ResourceAbsence"
						}
      				}
      			},
      			{
      				"action": "put",
      				"description": "Drop CreatedDate field from FSL_digest_ResourceAbsence_get_Demo_Data.",
      				"key": "FSL_digest_ResourceAbsence_get_Demo_Data_drop_CreatedDate",
      				"path": "$.workflowDefinition",
      				"value": {
      					"action": "sliceDataset",
						"parameters": {            
							"source": "FSL_digest_ResourceAbsence_get_Demo_Data",
							"mode": "drop",
							"fields": [
								{
									"name": "CreatedDate"
								}
							]
						}
      				}
      			},
      			{
      				"action": "put",
      				"description": "Rename CreatedDate__c field to CreatedDate in FSL_digest_ResourceAbsence_get_Demo_Data_drop_CreatedDate",
      				"key": "FSL_digest_ResourceAbsence_get_Demo_Data_rename_fields",
      				"path": "$.workflowDefinition",
      				"value": {
      					"action": "computeExpression",
						"parameters": {            
							"source": "FSL_digest_ResourceAbsence_get_Demo_Data_drop_CreatedDate",
							"mergeWithSource": true,
							"computedFields": [
								{
									"name": "CreatedDate",
									"type": "Date",
									"label": "CreatedDate",
									"saqlExpression": "toDate(CreatedDate__c, \"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\")",
									"default":"",
									"format":"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"
								}
							]
						}
      				}
      			},
      			{
      				"action": "put",
      				"description": "Final merge of user and demo data for ResourceAbsence.",
      				"key": "FSL_digest_ResourceAbsence_merge",
      				"path": "$.workflowDefinition",
      				"value": {
      					"action": "append",
						"parameters": {            
							"sources": [
								"FSL_digest_ResourceAbsence_get_Demo_Data_rename_fields",
								"FSL_digest_ResourceAbsence_get_Users_Data"
							]
						}
      				}
      			},
                        {
                              "action": "put",
                              "description": "Final cleaning of user and demo data for ResourceAbsence.",
                              "key": "FSL_digest_ResourceAbsence_cleaned",
                              "path": "$.workflowDefinition",
                              "value": {
                                    "action": "sliceDataset",
                                    "parameters": {            
                                          "source": "FSL_digest_ResourceAbsence_merge",
                                          "mode": "drop",
                                          "fields": [
                                                {
                                                      "name": "CreatedDate__c"
                                                },
                                                {
                                                      "name": "External_ID__c"
                                                }
                                          ]
                                    }
                              }
                        },
      			{
      				"action": "set",
      				"description": "Set the source property of FSL_compute_expression_ResourceAbsence_End_minus_Start.parameters based on Demo App or not.",
      				"path": "$.workflowDefinition.FSL_compute_expression_ResourceAbsence_End_minus_Start.parameters['source']",
      				"value": "${Constants.FSL_compute_expression_ResourceAbsence_End_minus_Start_params_source}"
      			}
			],						
			"appliesTo": [
        		{
        			"type": "workflow",
        			"name": "*"
        		}
      		]
		}
	]
}